<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  

  <!-- Primary Meta Tags -->
  <title>SEMS GPA PLUGIN</title>
  <link rel="shortcut icon" type="image/png" href="assets/logo-sems.png"/>
  <meta name="title" content="SEMS-GPA-PLUGIN">
  <meta name="description" content="Fetch Semester Results from SEMS and automate CGPA calculation">

  <meta name="thumbnail" content="https://sems-gpa.web.app/assets/logo-sems.png" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://sems-gpa.web.app/">
  <meta property="og:title" content="SEMS-GPA-PLUGIN">
  <meta property="og:description" content="Fetch Semester Results from SEMS and automate CGPA calculation">
  <meta property="og:image" content="https://sems-gpa.web.app/assets/logo-sems.png">

  <!--Bootstrap-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link href="style.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/6b08127ac9.js" crossorigin="anonymous"></script>
</head>

<body>
  <nav class="navbar">
    <div class="container">
      <span class="navbar-brand" href="#">
        <img  class="img-fluid" style="margin: 0 10px;" src="assets/logo-sems.png" alt="semslogo">SEMS-GPA-PLUGIN
      </span>
    </div>
  </nav>
  <div class="container" id="main-div">
    <div id="intro">
      <div id="intro_txt">
        Having Trouble in Calculating your GPA's ? 
        We will do it for you with a single click. 
        Just Login , No need to enter data Manually :)
        <br>  <br>
        <div id="intro_btn">
          <a href="#login" id="intro_link">Get Started <i class="fas fa-arrow-circle-down"></i></a>
        </div>  
      </div> 
      
      <div id="intro_img"></div>
    </div>
    <div style="font-size: 1.5rem;
    text-align: center;
    font-weight: bold;
    color: red;
    margin: 25px;"> 
      DISCLAIMER : WE ARE UNOFFICIAL<br>
      <small>(though we depend on the official SEMS)</small>
    </div>
    <div id="login">
      <legend id="login-tit" class="mb-3 col-sm|md|lg|xl">Login</legend>
      <div class="form-floating mb-3 col-sm|md|lg|xl" >
        <input type="text" class="form-control" id="reg_txt" placeholder="Register Number" required>
        <label for="reg_txt">Register Number</label>
      </div>
      <div class="form-floating mb-3 col-sm|md|lg|xl">
        <input type="password" class="form-control" id="pass_txt" placeholder="Password" required>
        <label for="pass_txt">Password</label>
      </div>

      <div id="load_captcha_div">
        <span class="spinner-border text-primary" role="status"></span><span>Loading Captcha</span>
      </div>
      <img class="img-fluid mb-3 col-sm|md|lg|xl" id="img_captcha">
      <div class="form-floating mb-3 col-sm|md|lg|xl">
        <input type="text" class="form-control" id="captcha_txt" placeholder="Captcha" required>
        <label for="captcha_txt">Captcha</label>
      </div>
      <button id="fetch" class="btn btn-primary" onclick="get_res()">
        FETCH
        <span class="spinner-grow spinner-grow-sm" id="fetch_loader" style="display: none;"></span>
      </button>
      <div id="error_div">Incorrect Captcha !</div>
      <div id="slow_div">Stay Chill !<br>It usually takes a while.</div>
    </div>
  </div>
  <div id="footer">
    <div>Â© 2021</div> 
    <div>Developed by  <a href="https://github.com/3-bro-grammers"><i class="fab fa-github"> 3-bro-grammers</i> </a>
  </div>
  <script>

    var temp_cookies;


    // to load captcha
    fetch("https://tv58io4a49.execute-api.us-east-2.amazonaws.com/default/sems-gpa",
      {
        method: "post",
        body: JSON.stringify({ captcha: null })
      }).then(res => res.json()).then((data) => {
        img_captcha.src = "data:image/jpeg;base64," + data.captcha;
        temp_cookies = data.cookies.join(" "); // data.cookies[0].substring(0, data.cookies[0].indexOf(";") + 1) + data.cookies[1].substring(0, data.cookies[1].indexOf(";") + 1);
        load_captcha_div.style.display = "none";
      })

    function get_res() {

      if(!(reg_txt.value && pass_txt.value && captcha_txt.value)){
        error_div.innerHTML = "Please fill in the Details !";
        error_div.style.display = "block"
        return;
      }

      fetch_loader.style.display = "inline-block";

      var slow_time_out = setTimeout(()=>{
        error_div.style.display = "none";
        slow_div.style.display = "block";
      },8000)


      // to fetch results
      fetch("https://tv58io4a49.execute-api.us-east-2.amazonaws.com/default/sems-gpa",
        {
          method: "post",
          body: JSON.stringify({
            reg: reg_txt.value,
            pass: pass_txt.value,
            captcha: captcha_txt.value,
            cookies: temp_cookies
          }),
        }).then(res => res.json()).then(data => {

          fetch_loader.style.display = "none";

          if(data.error){
            error_div.innerHTML = data.error=="INCORRECT_CAPTCHA"?"Incorrect Captcha !":(data.error=="INVALID_USER_PASS"?"Incorrect Reg. num.<br> & Password":"");
            error_div.style.display = "block";
            clearTimeout(slow_time_out);
            return;
          }

          //result.innerHTML = JSON.stringify(data, null, 4);
          // console.log(data);
          localStorage.setItem("sems",JSON.stringify(data));
          location.href="user.html";
          //console.log(calc_cgpa(data));
        })
    }
  </script>
</body>

</html>