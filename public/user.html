<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SEMS GPA PLUGIN</title>

  <!--Bootstrap-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link href="style.css" rel="stylesheet" />

  <!--
    
    <script defer src="/__/firebase/7.16.0/firebase-app.js"></script>
    
    <script defer src="/__/firebase/7.16.0/firebase-auth.js"></script>
    <script defer src="/__/firebase/7.16.0/firebase-database.js"></script>
    <script defer src="/__/firebase/7.16.0/firebase-messaging.js"></script>
    <script defer src="/__/firebase/7.16.0/firebase-storage.js"></script>
    
    <script defer src="/__/firebase/init.js"></script>
  -->

</head>
<script>
    var data;
     window.onload = () =>{
      data = JSON.parse(localStorage.getItem("data"));
      calc_cgpa(data);
     }
</script>
<body>
  <pre id="result">

  </pre>
  <script>
    function calc_cgpa(data) {
      var brcode = data["stud_details"]["brcode"];
      result.innerHTML = JSON.stringify(data, null, 4);
      var sem_tot_cred = [];
      var ret = {
        gpa: [],
        cgpa: 0
      }

      fetch(`credits/${brcode}.json`).then(res => res.json()).then(cred => {


        data["result"].forEach((e1, i1) => {
          var cur_sem_tot_cred = 0;
          var gpa_temp = 0;
          e1.forEach((e2, i2) => {
            if (!e2[2]) return;
            var cred_score = 10 - ["O", "A+", "A", "B+", "B"].indexOf(e2[2]);
            var sub_cred = cred[e2[0]] || 3;
            gpa_temp += cred_score * sub_cred;
            cur_sem_tot_cred += sub_cred;
          })
          ret["gpa"].push(gpa_temp / cur_sem_tot_cred);
          sem_tot_cred.push(cur_sem_tot_cred);
        })

        console.log(sem_tot_cred)

        var tot_cred = 0;
        var cgpa_temp = 0;
        sem_tot_cred.forEach((e, i) => {
          if (e) {
            tot_cred += e;
            cgpa_temp += e * ret["gpa"][i];
          }
        })
        ret["cgpa"] = cgpa_temp / tot_cred;

      })

      return ret;
    }
  </script>
</body>

</html>